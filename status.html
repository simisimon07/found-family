<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Application Status ‚Äî GuardianShield</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .status-hero {
      text-align: center; padding: 2rem 1rem 2.5rem;
    }
    .app-id-badge {
      display: inline-block;
      background: var(--card2); border: 1px solid var(--border);
      border-radius: var(--radius-sm); padding: 0.3rem 1rem;
      font-family: monospace; font-size: 0.9rem; color: var(--accent);
      margin-bottom: 1rem; letter-spacing: 1px;
    }
    .status-hero h1 {
      font-family: var(--font-display);
      font-size: 1.8rem; font-weight: 800; letter-spacing: -0.5px;
    }
    .status-hero p { color: var(--muted); margin-top: 0.4rem; }

    /* Progress tracker */
    .progress-track {
      display: flex; align-items: flex-start; justify-content: center;
      gap: 0; margin: 2.5rem 0; flex-wrap: wrap;
      position: relative;
    }
    .progress-step {
      display: flex; flex-direction: column; align-items: center;
      gap: 0.5rem; flex: 1; min-width: 100px; max-width: 160px;
      text-align: center; position: relative;
    }
    .progress-step:not(:last-child)::after {
      content: '';
      position: absolute; top: 18px; left: calc(50% + 18px);
      width: calc(100% - 36px); height: 2px;
      background: var(--border);
      z-index: 0;
    }
    .progress-step.done:not(:last-child)::after { background: var(--accent); }
    .progress-step.active:not(:last-child)::after {
      background: linear-gradient(90deg, var(--accent), var(--border));
    }
    .progress-icon {
      width: 38px; height: 38px; border-radius: 50%;
      background: var(--card2); border: 2px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; position: relative; z-index: 1;
      transition: all 0.3s;
    }
    .progress-step.done .progress-icon {
      background: var(--accent); border-color: var(--accent); font-size: 0.9rem;
    }
    .progress-step.active .progress-icon {
      border-color: var(--accent); background: var(--accent-light);
      box-shadow: 0 0 0 4px rgba(0,168,107,0.15);
      animation: activePulse 2s ease-in-out infinite;
    }
    @keyframes activePulse {
      0%,100%{box-shadow:0 0 0 4px rgba(0,168,107,0.15)}
      50%{box-shadow:0 0 0 8px rgba(0,168,107,0.05)}
    }
    .progress-label {
      font-size: 0.75rem; font-weight: 600; color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .progress-step.done .progress-label,
    .progress-step.active .progress-label { color: var(--text); }
    .progress-sub { font-size: 0.7rem; color: var(--muted); }

    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
    @media(max-width:540px){ .info-grid { grid-template-columns: 1fr; } }

    .info-item { }
    .info-item-label { font-size: 0.75rem; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem; }
    .info-item-value { font-size: 0.95rem; font-weight: 500; }

    .ai-notice {
      background: rgba(59,130,246,0.08);
      border: 1px solid rgba(59,130,246,0.2);
      border-radius: var(--radius-sm);
      padding: 1rem 1.2rem;
      display: flex; gap: 0.8rem; align-items: flex-start;
      font-size: 0.85rem; color: var(--muted);
    }
    .ai-notice strong { color: var(--info); display: block; margin-bottom: 0.2rem; }

    .what-next { margin-top: 1.5rem; }
    .what-next h3 { font-family: var(--font-display); font-size: 0.95rem; font-weight: 700; margin-bottom: 0.8rem; }
    .next-item {
      display: flex; gap: 0.8rem; align-items: flex-start;
      padding: 0.7rem 0; border-bottom: 1px solid var(--border);
      font-size: 0.88rem;
    }
    .next-item:last-child { border-bottom: none; }
    .next-item-icon { width: 28px; height: 28px; border-radius: 6px; background: var(--card2); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.85rem; }
    .next-item-text { flex: 1; }
    .next-item-title { font-weight: 600; margin-bottom: 0.15rem; }
    .next-item-sub { color: var(--muted); font-size: 0.82rem; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="nav-brand" style="text-decoration:none">üõ°Ô∏è GuardianShield</a>
    <div class="nav-links">
      <a href="apply.html">Apply</a>
      <a href="dashboard.html">Admin</a>
    </div>
  </nav>

  <main class="page">
    <div class="status-hero">
      <div class="app-id-badge" id="appIdBadge">GS-XXXXXX</div>
      <h1 id="statusTitle">Application Received</h1>
      <p id="statusSubtitle">Your application is currently under review by our team</p>
    </div>

    <!-- Progress tracker -->
    <div class="progress-track">
      <div class="progress-step done" id="step1">
        <div class="progress-icon">‚úì</div>
        <div class="progress-label">Submitted</div>
        <div class="progress-sub" id="submitTime">‚Äî</div>
      </div>
      <div class="progress-step done" id="step2">
        <div class="progress-icon">‚úì</div>
        <div class="progress-label">AI Screened</div>
        <div class="progress-sub">Automated</div>
      </div>
      <div class="progress-step active" id="step3">
        <div class="progress-icon">üëÅÔ∏è</div>
        <div class="progress-label">Human Review</div>
        <div class="progress-sub">In progress</div>
      </div>
      <div class="progress-step" id="step4">
        <div class="progress-icon">üìã</div>
        <div class="progress-label">Decision</div>
        <div class="progress-sub">Pending</div>
      </div>
    </div>

    <div style="display:grid; grid-template-columns: 1.4fr 1fr; gap:1rem; align-items:start;">
      <!-- Application Summary -->
      <div class="card">
        <div class="card-title">üìÑ Application Summary</div>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-item-label">Applicant Name</div>
            <div class="info-item-value" id="infoName">‚Äî</div>
          </div>
          <div class="info-item">
            <div class="info-item-label">Occupation</div>
            <div class="info-item-value" id="infoOccupation">‚Äî</div>
          </div>
          <div class="info-item">
            <div class="info-item-label">Submitted</div>
            <div class="info-item-value" id="infoDate">‚Äî</div>
          </div>
          <div class="info-item">
            <div class="info-item-label">Current Status</div>
            <div class="info-item-value" id="infoStatus">
              <span class="pill pill-warn">Under Review</span>
            </div>
          </div>
        </div>

        <hr class="divider"/>

        <div class="ai-notice">
          <span style="font-size:1.3rem; flex-shrink:0;">ü§ñ</span>
          <div>
            <strong>AI Pre-Screening Complete</strong>
            Your application has been analyzed by our AI system. Risk flags have been prepared for the human reviewer. The AI does not make decisions ‚Äî it only highlights areas for the caseworker to examine.
          </div>
        </div>

        <div class="what-next">
          <h3>What happens next</h3>
          <div class="next-item">
            <div class="next-item-icon">üë§</div>
            <div class="next-item-text">
              <div class="next-item-title">Assigned to a Caseworker</div>
              <div class="next-item-sub">A human reviewer will examine your application and the AI risk report</div>
            </div>
          </div>
          <div class="next-item">
            <div class="next-item-icon">üìû</div>
            <div class="next-item-text">
              <div class="next-item-title">Possible Follow-up</div>
              <div class="next-item-sub">You may be contacted if additional documents or clarification is needed</div>
            </div>
          </div>
          <div class="next-item">
            <div class="next-item-icon">‚úâÔ∏è</div>
            <div class="next-item-text">
              <div class="next-item-title">Decision Notification</div>
              <div class="next-item-sub">You'll be notified by email and SMS within 5‚Äì7 working days</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Risk score sneak peek -->
      <div>
        <div class="card" id="riskCard">
          <div class="card-title">üõ°Ô∏è AI Risk Summary</div>
          <div style="text-align:center; padding: 0.5rem 0 1.2rem;">
            <div style="font-size:0.75rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:var(--muted); margin-bottom:0.5rem;">Risk Score</div>
            <div style="font-size:4rem; font-weight:800; font-family:var(--font-display); line-height:1;" id="scoreDisplay">‚Äî</div>
            <div style="font-size:0.8rem; color:var(--muted);">out of 100</div>
            <div style="margin-top:0.8rem;" id="riskBadge"><span class="pill pill-warn">Calculating...</span></div>
          </div>
          <div class="risk-bar-wrap">
            <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--muted);margin-bottom:0.3rem;">
              <span>Risk Level</span><span id="scoreLabel">‚Äî</span>
            </div>
            <div class="risk-bar-track">
              <div class="risk-bar-fill" id="riskBarFill" style="width:0%"></div>
            </div>
          </div>
          <hr class="divider"/>
          <div style="font-size:0.8rem; color:var(--muted); text-align:center; font-style:italic; line-height:1.5;">
            This score is AI-generated and advisory only.<br/>
            A human caseworker makes all final decisions.
          </div>
        </div>

        <div style="margin-top:1rem;">
          <a href="apply.html" class="btn btn-ghost" style="width:100%; justify-content:center; text-align:center;">
            ‚Üê Submit Another Application
          </a>
        </div>
      </div>
    </div>

    @media(max-width:640px){
      div[style*="grid-template-columns: 1.4fr"] {
        grid-template-columns: 1fr !important;
      }
    }
  </main>

  <script>
    const app = JSON.parse(localStorage.getItem('gs_current_app') || 'null');

    if (!app) {
      // Demo mode ‚Äî use a mock
      const mock = {
        id: 'GS-DEMO01',
        name: 'Priya Sharma',
        occupation: 'Teacher',
        riskScore: 62,
        status: 'pending',
        submittedAt: new Date().toISOString(),
      };
      populatePage(mock);
    } else {
      populatePage(app);
    }

    function populatePage(app) {
      document.getElementById('appIdBadge').textContent = app.id;
      document.getElementById('infoName').textContent = app.name || '‚Äî';
      document.getElementById('infoOccupation').textContent = app.occupation || '‚Äî';

      const d = new Date(app.submittedAt);
      const formatted = d.toLocaleDateString('en-IN', { day:'numeric', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' });
      document.getElementById('infoDate').textContent = formatted;
      document.getElementById('submitTime').textContent = d.toLocaleTimeString('en-IN', {hour:'2-digit',minute:'2-digit'});

      // Status
      if (app.status === 'approved') {
        document.getElementById('statusTitle').textContent = 'Application Approved ‚úì';
        document.getElementById('infoStatus').innerHTML = '<span class="pill pill-success">Approved</span>';
        document.getElementById('step3').className = 'progress-step done';
        document.getElementById('step3').querySelector('.progress-icon').textContent = '‚úì';
        document.getElementById('step4').className = 'progress-step done';
        document.getElementById('step4').querySelector('.progress-icon').textContent = '‚úì';
      } else if (app.status === 'rejected') {
        document.getElementById('statusTitle').textContent = 'Application Rejected';
        document.getElementById('infoStatus').innerHTML = '<span class="pill pill-danger">Rejected</span>';
      } else if (app.status === 'info_needed') {
        document.getElementById('statusTitle').textContent = 'More Information Required';
        document.getElementById('infoStatus').innerHTML = '<span class="pill pill-info">Info Needed</span>';
      }

      // Animate score
      const score = app.riskScore;
      let current = 0;
      const display = document.getElementById('scoreDisplay');
      const interval = setInterval(() => {
        current = Math.min(current + 2, score);
        display.textContent = current;
        if (current >= score) clearInterval(interval);
      }, 30);

      // Risk bar
      setTimeout(() => {
        const fill = document.getElementById('riskBarFill');
        fill.style.width = score + '%';
        let cls, label, pill;
        if (score >= 65) { cls='high'; label='High Risk'; pill='pill-danger'; }
        else if (score >= 35) { cls='medium'; label='Medium Risk'; pill='pill-warn'; }
        else { cls='low'; label='Low Risk'; pill='pill-success'; }
        fill.className = 'risk-bar-fill ' + cls;
        document.getElementById('scoreLabel').textContent = label;
        document.getElementById('riskBadge').innerHTML = `<span class="pill ${pill}">${label}</span>`;
      }, 400);
    }
  </script>

  <style>
    @media(max-width:640px){
      main > div[style] { grid-template-columns: 1fr !important; }
    }
  </style>
</body>
</html>
